---
layout: post
title: Making the most of your docstrings
date: 2021-02-20 21:12:00 +0100
author: Charles Tapley Hoyt
tags: python
---
Writing excellent documentation is crucial for open source software projects. It's also a *lot* of
hard work. I consider tools like [Sphinx](https://www.sphinx-doc.org) combine with services
like [ReadTheDocs](https://readthedocs.org/) completely invaluable, but I've recently hit a
roadblock when it comes to making the README of a GitHub repository a bit more dynamic. This blog
post is about the dark magic I invented to support this.

This journey will be framed through my work on the documentation of
[PyKEEN](https://github.com/pykeen/pykeen/), a machine learning library for learning low-dimensional
embeddings for nodes and edges in knowledge graphs. In this blog post, you don't need to understand
anything about the package itself other than it has several types of interchangable components that
can be combined to create a "model" that gets trained on a dataset. The documentation uses the
[`sphinx-automodapi`](https://sphinx-automodapi.readthedocs.io) extension to generate pretty listsof
all the datasets, models, loss functions, regularizers, etc.

The problem is that most people start by either looking at the README file in the GitHub repository,
or the splash text on the PyPI project page (which is for PyKEEN and most packages is created with
the README on upload). I wanted to generate beautiful lists of the components on the README file the
same as in the Sphinx documentation, so I started by writing a template markdown file
using [`jinja`](https://jinja.palletsprojects.com) as a templating language. For each type of
component, I programatically built a table, formatted it as markdown
with [`tabulate`](https://pypi.org/project/tabulate/), and formatted it into the template.

The tricky part was making these tables useful. Sphinx has a deep integration with the restructured
text (RST) format and provides "directives" like `:class:` that allow for automatic linking between
documentation for modules, classes, functions, variables, or anything else. Luckily, the
`sphinx-automodapi` uses a standard format for its documentation. For example,
the `pykeen. models.ComplEx` class gets built with a url
like `https://pykeen.readthedocs.io/en/stable/api/pykeen.models.ComplEx.html`. The general form 
for is `https://pykeen.readthedocs.io/en/stable/api/<X>.html`. I was able to take advantage of 
this and generate a column with the name of the class in PyKEEN, which is useful for people to 
know directly how to import it, and also linking to the documentation on ReadTheDocs.

The next tricky part was dealing with citations. Especially for new users, it's nice to have the 
citation for each model in case they want to know more than the PyKEEN documentation provides 
(though it is one of my goals for PyKEEN's documentation to be an educational resource that in 
many cases will be more useful than reading manuscripts written by computer scientists, whose 
goals are to make themselves smart more than to motivate and educate the reader). In RST,
there's a standard citation format.